# 프롬프트

프롬프트 단계는 검색기에서 검색된 문서들을 바탕으로 언어 모델이 사용할 질문이나 명령을 생성하는 과정이다.

 - 문맥(Context) 설정: 프롬프트는 언어 모델이 특정 문맥에서 작동하도록 설정하는 역할을 한다. 이를 통해 모델은 제공된 정보를 바탕으로 보다 정확하고 관련성 높은 답변을 생성할 수 있다.
 - 정보 통합: 여러 문서에서 검색된 정보는 서로 다른 관점이나 내용을 포함할 수 있다. 프롬프트 단계에서 이러한 정보를 통합하고, 모델이 이를 효율적으로 활용할 수 있는 형식으로 조정한다.
 - 응답 품질 향상: 질문에 대한 모델의 응답 품질은 프롬프트의 구성에 크게 의존한다. 잘 구성된 프롬프트는 모델이 보다 정확하고 유용한 정보를 제공하게 돕는다.
 - __프롬프트 구조__
    - 지시사항
    - 질문(사용자 입력 질문)
    - 문맥(검색된 정보)
```
당신은 질문-답변(Question-Answer) Task 를 수행한는 AI 어시스턴트 입니다.
검색된 문맥(context)를 사용하여 질문(question)에 답하세요. 
만약, 문맥(context) 으로부터 답을 찾을 수 없다면 '모른다' 고 말하세요. 
한국어로 대답하세요.

#Question: 
{이곳에 사용자가 입력한 질문이 삽입됩니다}

#Context: 
{이곳에 검색된 정보가 삽입됩니다}
```
<br/>

## 1. 프롬프트 템플릿 만들기

 - `from_template() 메소드를 사용하여 PromptTemplate 객체 생성`
```python
from langchain_core.prompts import PromptTemplate

template = "{country}의 수도는 어디인가요?"
prompt = PromptTemplate.from_template(template)

# Chain 생성
chain = prompt | llm

chain.invoke("대한민국")
```
<br/>

 - `PromptTemplate 객체 생성과 동시에 prompt 생성`
```python
template = "{country}의 수도는 어디인가요?"
prompt = PromptTemplate(
    template=template,
    input_variables=["country"],
)
prompt.format(country="대한민국")
```
<br/>

 - `일부 변수 확정 짓기(partial_variables)`
    - 두 개 이상의 변수를 처리하는 경우 partial_variables를 이용하여 일부 변수를 확정지을 수 있다.
```python
template = "{country1}과 {country2}의 수도는 각각 어디인가요?"
prompt = PromptTemplate(
    template=template,
    input_variables=["country1"],
    partial_variables={
        "country2": "미국"  # dictionary 형태로 partial_variables를 전달
    },
)

prompt.format(country1="대한민국") # '대한민국과 미국의 수도는 각각 어디인가요?'

# partial() 메서드를 사용하면 템플릿의 일부 변수를 미리 채워 둘 수 있다.
prompt_partial = prompt.partial(country2="캐나다")
prompt_partial.format(country1="대한민국") # '대한민국과 캐나다의 수도는 각각 어디인가요?'

# partial()로 설정된 값도 새로운 값으로 대체될 수 있다. (체인에서 invoke() 메서드로 설정시)
chain.invoke({"country1": "대한민국", "country2": "호주"}).content # '대한민국의 수도는 서울이고 호주의 수도는 캔버라입니다.'
```
<br/>


 - `partial_varialbes(함수 사용)`
    - partial을 사용하는 일반적인 용도는 함수를 부분적으로 사용하는 것이다.
```python
from datetime import datetime

# 오늘 날짜를 출력
datetime.now().strftime("%B %d")

# 날짜를 반환하는 함수 정의
def get_today():
    return datetime.now().strftime("%B %d")

prompt = PromptTemplate(
    template="오늘의 날짜는 {today} 입니다. 오늘이 생일인 유명인 {n}명을 나열해 주세요. 생년월일을 표기해주세요.",
    input_variables=["n"],
    partial_variables={
        "today": get_today  # dictionary 형태로 partial_variables를 전달
    },
)
prompt.format(n=3)
chain = prompt | llm


print(chain.invoke(3).content)
print(chain.invoke({"today": "Jan 02", "n": 3}).content)
```
